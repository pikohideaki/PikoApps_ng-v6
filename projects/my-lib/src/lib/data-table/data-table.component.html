<ng-container *ngIf="{
      tableSlicedTransformed: tableSlicedTransformed$ | async,
      tableFilteredRowSize:   tableFilteredRowSize$   | async,
      table:                  table$                  | async,
      itemsPerPage:           itemsPerPage$           | async,
      columnStates:           columnStates$           | async
    } as data">
  <lib-app-waiting-spinner [waiting]="!data.table"></lib-app-waiting-spinner>

  <ng-container *ngIf="!!data.table">
    <div *ngIf="usePagenation && itemsPerPageOptions !== undefined"
        class="pager-wrapper">
      <lib-items-per-page
          [options]='itemsPerPageOptions'
          [itemsPerPage]='data.itemsPerPage'
          (itemsPerPageChange)="itemsPerPageOnChange( $event )">
      </lib-items-per-page>
      <lib-pagenation
          [itemsPerPage$]='itemsPerPage$'
          [rowSize$]='tableFilteredRowSize$'
          [pageNumber$]='pageNumber$'
          (pageNumberChange)="pageNumberOnChange( $event )">
      </lib-pagenation>
      <button class='resetButton' mat-raised-button (click)="resetAll()">
        Reset All
      </button>
      <div>{{data.tableFilteredRowSize}} items</div>
    </div>

    <table class='data-table data-table--shadow3px data-table--vertical-line'>
      <thead>
        <tr>
          <th *ngFor='let column of data.columnStates'
              [class.data-table--cell-alignLeft]  ="column.align === 'l' "
              [class.data-table--cell-alignCenter]="column.align === 'c' "
              [class.data-table--cell-alignRight] ="column.align === 'r' " >
            <ng-container [ngSwitch]="column.manip">
              <ng-container *ngSwitchCase="'input'">
                <mat-form-field>
                  <input matInput
                      id="filteringInputBox"
                      [placeholder]="column.headerTitle"
                      [value]="column.manipState || ''"
                      (input)="changeColumnState( column.name, $event.target.value )" >
                  <button matSuffix mat-icon-button (click)="reset( column.name )">
                    <mat-icon class='clear-select-icon'>clear</mat-icon>
                  </button>
                </mat-form-field>
              </ng-container>
              <ng-container *ngSwitchCase="'select'">
                <mat-form-field>
                  <mat-select
                      [placeholder]="column.headerTitle"
                      [value]="column.manipState || ''"
                      (change)="changeColumnState( column.name, $event.value )" >
                    <mat-option *ngFor="let option of column.selectOptions"
                        [value]="option.value">
                      {{option.viewValue}}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
                <button mat-icon-button (click)="reset( column.name )">
                  <mat-icon class='clear-select-icon'>clear</mat-icon>
                </button>
              </ng-container>
              <ng-container *ngSwitchCase="'multiSelect-and'">
                <mat-form-field>
                  <mat-select
                        [placeholder]="column.headerTitle"
                        [value]="column.manipState"
                        (change)="changeColumnState( column.name, $event.value )"
                        multiple>
                    <mat-option *ngFor="let option of column.selectOptions"
                        [value]="option.value">
                      {{option.viewValue}}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
                <button mat-icon-button (click)="reset( column.name )">
                  <mat-icon class='clear-select-icon'>clear</mat-icon>
                </button>
              </ng-container>
              <ng-container *ngSwitchCase="'multiSelect-or'">
                <mat-form-field>
                  <mat-select
                        [placeholder]="column.headerTitle"
                        [value]="column.manipState"
                        (change)="changeColumnState( column.name, $event.value )"
                        multiple>
                    <mat-option *ngFor="let option of column.selectOptions"
                        [value]="option.value">
                      {{option.viewValue}}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
                <button mat-icon-button (click)="reset( column.name )">
                  <mat-icon class='clear-select-icon'>clear</mat-icon>
                </button>
              </ng-container>
              <ng-container *ngSwitchDefault>
                <span> {{column.headerTitle}} </span>
              </ng-container>
            </ng-container>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor='let value of data.tableSlicedTransformed; let rowIndex = index'>
          <td *ngFor='let column of data.columnStates'
              [class.data-table--cell-alignLeft]  ="column.align=='l'"
              [class.data-table--cell-alignCenter]="column.align=='c'"
              [class.data-table--cell-alignRight] ="column.align=='r'" >

            <div *ngIf="column.isButton; then thenBlock; else elseBlock"></div>
            <ng-template #thenBlock>
              <button mat-button color="primary"
                    (click)="cellOnClick(
                        data.table,
                        rowIndex,
                        column.name,
                        data.columnStates )">
                {{ value[column.name] }}
              </button>
            </ng-template>
            <ng-template #elseBlock>
              {{ value[column.name] }}
            </ng-template>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="usePagenation && itemsPerPageOptions !== undefined"
        class="pager-wrapper">
      <lib-items-per-page
          [options]='itemsPerPageOptions'
          [itemsPerPage]='data.itemsPerPage'
          (itemsPerPageChange)="itemsPerPageOnChange( $event )">
      </lib-items-per-page>
      <lib-pagenation
          [itemsPerPage$]='itemsPerPage$'
          [rowSize$]='tableFilteredRowSize$'
          [pageNumber$]='pageNumber$'
          (pageNumberChange)="pageNumberOnChange( $event )">
      </lib-pagenation>
      <div>{{data.tableFilteredRowSize}} items</div>
    </div>
  </ng-container>
</ng-container>

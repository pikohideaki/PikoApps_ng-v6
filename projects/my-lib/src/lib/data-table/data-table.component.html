<ng-container *ngIf="{
      table:                  table$                  | async,
      tableSlicedTransformed: tableSlicedTransformed$ | async,
      itemsPerPage:           itemsPerPage$           | async,
      headerValuesAll:        headerValuesAll$        | async,
      selectorOptionsAll:     selectorOptionsAll$     | async
    } as data">
  <lib-app-waiting-spinner [waiting]="!data.table"></lib-app-waiting-spinner>

  <ng-container *ngIf="!!data.table">
    <div *ngIf="usePagenation && itemsPerPageOptions !== undefined"
        class="pager-wrapper">
      <lib-items-per-page
          [options]='itemsPerPageOptions'
          [itemsPerPage]='data.itemsPerPage'
          (itemsPerPageChange)="itemsPerPageOnChange( $event )">
      </lib-items-per-page>
      <lib-pagenation
          [itemsPerPage$]='itemsPerPage$'
          [pageLength$]='pageLength$'
          [pageNumber$]='pageNumber$'
          [rowSize$]='tableFilteredRowSize$'
          (pageNumberChange)="pageNumberOnChange( $event )">
      </lib-pagenation>
      <button class='resetButton' mat-raised-button (click)="resetAll()">
        Reset All
      </button>
      <div>{{data.tableSlicedTransformed.length}} items</div>
    </div>

    <table class='data-table data-table--shadow3px data-table--vertical-line'>
      <thead>
        <tr>
          <th *ngFor='let header of headerSettings; let idx = index'
              [class.data-table--cell-alignLeft]  ="header.align === 'l' "
              [class.data-table--cell-alignCenter]="header.align === 'c' "
              [class.data-table--cell-alignRight] ="header.align === 'r' " >
            <lib-header-cell
              [selectorValue]="data.headerValuesAll[idx]"
              [selectorOptions]="data.selectorOptionsAll[idx]"
              (selectorValueChange)="selectorValueOnChange( idx, $event )"
              (reset)="reset( idx, $event )">
            </lib-header-cell>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor='let value of data.tableSlicedTransformed; let rowIndex = index'>
          <td *ngFor='let header of headerSettings'
              [class.data-table--cell-alignLeft]  ="header.align=='l'"
              [class.data-table--cell-alignCenter]="header.align=='c'"
              [class.data-table--cell-alignRight] ="header.align=='r'" >

            <div *ngIf="header.isButton; then thenBlock; else elseBlock"></div>
            <ng-template #thenBlock>
              <button mat-button color="primary"
                    (click)="cellOnClick(
                        data.table,
                        rowIndex,
                        header.id,
                        data.headerValues )">
                {{ value[header.name] }}
              </button>
            </ng-template>
            <ng-template #elseBlock>
              {{ value[header.name] }}
            </ng-template>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="usePagenation && itemsPerPageOptions !== undefined"
        class="pager-wrapper">
      <lib-items-per-page
          [options]='itemsPerPageOptions'
          [itemsPerPage]='data.itemsPerPage'
          (itemsPerPageChange)="itemsPerPageOnChange( $event )">
      </lib-items-per-page>
      <lib-pagenation
          [itemsPerPage$]='itemsPerPage$'
          [pageLength$]='pageLength$'
          [pageNumber$]='pageNumber$'
          [rowSize$]='tableFilteredRowSize$'
          (pageNumberChange)="pageNumberOnChange( $event )">
      </lib-pagenation>
      <div>{{data.tableSlicedTransformed.length}} items</div>
    </div>
  </ng-container>
</ng-container>
